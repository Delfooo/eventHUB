<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <a href="/" class="logo">
                <i class="fas fa-calendar-alt"></i>
                EventHub
            </a>
            
            <div class="nav-links" id="navLinks">
                <a href="/" class="nav-link">
                    <i class="fas fa-home"></i> Home
                </a>
                <a href="/dashboard" class="nav-link">
                    <i class="fas fa-th-large"></i> Dashboard
                </a>
                <a href="/my-events" class="nav-link">
                    <i class="fas fa-calendar-check"></i> I Miei Eventi
                </a>
                <a href="/profile" class="nav-link active">
                    <i class="fas fa-user"></i> Profilo
                </a>
                
                <a href="/admin" class="nav-link admin-only" id="adminLink" style="display: none;">
                    <i class="fas fa-shield-alt"></i> Admin
                </a>
                
                <button class="btn btn-danger btn-sm" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
            
            <button class="hamburger" id="hamburger">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="profile-main">
        <div class="container">
            
            <!-- Profile Header -->
            <div class="profile-header">
                <div class="profile-avatar-section">
                    <div class="profile-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <button class="btn btn-secondary btn-sm">
                        <i class="fas fa-camera"></i> Cambia Foto
                    </button>
                </div>
                
                <div class="profile-info">
                    <h1 id="profileUsername">Caricamento...</h1>
                    <p id="profileEmail">email@example.com</p>
                    <span class="profile-role-badge" id="profileRole">Utente</span>
                    <p class="profile-member-since">
                        <i class="fas fa-calendar-alt"></i>
                        Membro da <span id="memberSince">--</span>
                    </p>
                </div>
            </div>

            <!-- Alert Container -->
            <div id="alertContainer"></div>

            <!-- Profile Content -->
            <div class="profile-content">
                
                <!-- Sidebar -->
                <aside class="profile-sidebar">
                    <nav class="profile-nav">
                        <a href="#account" class="profile-nav-link active" data-section="account">
                            <i class="fas fa-user-circle"></i>
                            <span>Informazioni Account</span>
                        </a>
                        <a href="#security" class="profile-nav-link" data-section="security">
                            <i class="fas fa-lock"></i>
                            <span>Sicurezza</span>
                        </a>
                        <a href="#preferences" class="profile-nav-link" data-section="preferences">
                            <i class="fas fa-cog"></i>
                            <span>Preferenze</span>
                        </a>
                        <a href="#danger" class="profile-nav-link danger" data-section="danger">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Zona Pericolosa</span>
                        </a>
                    </nav>
                </aside>

                <!-- Content Area -->
                <div class="profile-sections">
                    
                    <!-- SEZIONE ACCOUNT -->
                    <section id="account-section" class="profile-section active">
                        <div class="section-header">
                            <h2>
                                <i class="fas fa-user-circle"></i>
                                Informazioni Account
                            </h2>
                            <p class="section-subtitle">Gestisci le tue informazioni personali</p>
                        </div>

                        <form id="profileForm" class="profile-form">
                            <div class="form-group">
                                <label for="username">
                                    <i class="fas fa-user"></i> Username
                                </label>
                                <input 
                                    type="text" 
                                    id="username" 
                                    class="form-control"
                                    placeholder="Il tuo username"
                                    required
                                    minlength="3"
                                    maxlength="30"
                                >
                                <small class="form-hint">Minimo 3 caratteri, massimo 30</small>
                            </div>

                            <div class="form-group">
                                <label for="email">
                                    <i class="fas fa-envelope"></i> Email
                                </label>
                                <input 
                                    type="email" 
                                    id="email" 
                                    class="form-control"
                                    placeholder="tua@email.com"
                                    required
                                >
                                <small class="form-hint">Utilizzeremo questa email per le comunicazioni</small>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="resetProfileForm()">
                                    <i class="fas fa-undo"></i> Annulla
                                </button>
                                <button type="submit" class="btn btn-primary" id="saveProfileBtn">
                                    <i class="fas fa-save"></i> Salva Modifiche
                                </button>
                            </div>
                        </form>
                    </section>

                    <!-- SEZIONE SICUREZZA -->
                    <section id="security-section" class="profile-section">
                        <div class="section-header">
                            <h2>
                                <i class="fas fa-lock"></i>
                                Sicurezza
                            </h2>
                            <p class="section-subtitle">Gestisci password e impostazioni di sicurezza</p>
                        </div>

                        <div class="security-card">
                            <h3>
                                <i class="fas fa-key"></i>
                                Cambia Password
                            </h3>
                            
                            <form id="passwordForm" class="profile-form">
                                <div class="form-group">
                                    <label for="currentPassword">
                                        <i class="fas fa-lock"></i> Password Attuale
                                    </label>
                                    <div class="password-input">
                                        <input 
                                            type="password" 
                                            id="currentPassword" 
                                            class="form-control"
                                            placeholder="Password attuale"
                                            required
                                            minlength="6"
                                        >
                                        <button type="button" class="toggle-password" onclick="togglePasswordVisibility('currentPassword')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="newPassword">
                                        <i class="fas fa-lock"></i> Nuova Password
                                    </label>
                                    <div class="password-input">
                                        <input 
                                            type="password" 
                                            id="newPassword" 
                                            class="form-control"
                                            placeholder="Nuova password"
                                            required
                                            minlength="6"
                                        >
                                        <button type="button" class="toggle-password" onclick="togglePasswordVisibility('newPassword')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <small class="form-hint">Minimo 6 caratteri</small>
                                    
                                    <!-- Password Strength -->
                                    <div class="password-strength" id="passwordStrength">
                                        <div class="strength-bar"></div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="confirmPassword">
                                        <i class="fas fa-lock"></i> Conferma Nuova Password
                                    </label>
                                    <div class="password-input">
                                        <input 
                                            type="password" 
                                            id="confirmPassword" 
                                            class="form-control"
                                            placeholder="Conferma password"
                                            required
                                            minlength="6"
                                        >
                                        <button type="button" class="toggle-password" onclick="togglePasswordVisibility('confirmPassword')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary" id="changePasswordBtn">
                                        <i class="fas fa-key"></i> Cambia Password
                                    </button>
                                </div>
                            </form>
                        </div>

                        <div class="security-card">
                            <h3>
                                <i class="fas fa-history"></i>
                                Ultimo Accesso
                            </h3>
                            <p id="lastLoginInfo">Caricamento...</p>
                        </div>
                    </section>

                    <!-- SEZIONE PREFERENZE -->
                    <section id="preferences-section" class="profile-section">
                        <div class="section-header">
                            <h2>
                                <i class="fas fa-cog"></i>
                                Preferenze
                            </h2>
                            <p class="section-subtitle">Personalizza la tua esperienza</p>
                        </div>

                        <div class="preferences-card">
                            <h3>Notifiche</h3>
                            
                            <div class="preference-item">
                                <div>
                                    <strong>Notifiche Email</strong>
                                    <p>Ricevi aggiornamenti via email</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="preference-item">
                                <div>
                                    <strong>Notifiche Push</strong>
                                    <p>Ricevi notifiche nel browser</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="preference-item">
                                <div>
                                    <strong>Newsletter</strong>
                                    <p>Ricevi la newsletter settimanale</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="preferences-card">
                            <h3>Privacy</h3>
                            
                            <div class="preference-item">
                                <div>
                                    <strong>Profilo Pubblico</strong>
                                    <p>Rendi visibile il tuo profilo</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="preference-item">
                                <div>
                                    <strong>Mostra Email</strong>
                                    <p>Mostra la tua email agli organizzatori</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </section>

                    <!-- SEZIONE DANGER ZONE -->
                    <section id="danger-section" class="profile-section">
                        <div class="section-header">
                            <h2>
                                <i class="fas fa-exclamation-triangle"></i>
                                Zona Pericolosa
                            </h2>
                            <p class="section-subtitle">Azioni irreversibili</p>
                        </div>

                        <div class="danger-card">
                            <div class="danger-content">
                                <h3>Elimina Account</h3>
                                <p>Una volta eliminato, il tuo account non potr√† essere recuperato. Tutti i tuoi dati verranno cancellati definitivamente.</p>
                            </div>
                            <button class="btn btn-danger" onclick="deleteAccount()">
                                <i class="fas fa-trash-alt"></i> Elimina Account
                            </button>
                        </div>
                    </section>

                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 EventHub. Tutti i diritti riservati.</p>
            <div class="footer-links">
                <a href="#">Privacy Policy</a>
                <a href="#">Termini di Servizio</a>
                <a href="#">Contatti</a>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="/js/utils.js"></script>
    <script src="/js/profile.js"></script>
    <script>
        if (!requireAuth()) {
            window.location.href = '/login';
        } else {
            checkAuthStatus();
        }
    </script>
</body>
</html>